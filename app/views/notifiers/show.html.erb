<% page_header @notifier.name do %>
  <%= link_to "Edit", edit_notifier_path(@notifier), class: "inline-flex items-center rounded-xl border-2 border-gray-200 bg-white px-4 py-2.5 text-sm font-semibold text-gray-700 hover:bg-gray-50" %>
  <%= button_to "Delete", @notifier, method: :delete, class: "ml-3 inline-flex items-center rounded-xl bg-red-600 px-4 py-2.5 text-sm font-semibold text-white hover:bg-red-500", data: { turbo_confirm: "Are you sure you want to delete this notifier?" } %>
<% end %>

<div class="space-y-6">
  <%# Notifier Details %>
  <div class="bg-white rounded-2xl border-2 border-gray-200">
    <div class="px-4 py-6 sm:px-6 flex items-center justify-between">
      <h3 class="text-base font-semibold text-gray-900">Notifier Details</h3>
      <% if @notifier.enabled? %>
        <span class="inline-flex items-center rounded-full bg-green-50 px-2.5 py-1 text-xs font-medium text-green-700 ring-1 ring-inset ring-green-600/20">
          Enabled
        </span>
      <% else %>
        <span class="inline-flex items-center rounded-full bg-gray-50 px-2.5 py-1 text-xs font-medium text-gray-600 ring-1 ring-inset ring-gray-500/10">
          Disabled
        </span>
      <% end %>
    </div>
    <div class="border-t border-gray-100">
      <dl class="divide-y divide-gray-100">
        <div class="px-4 py-4 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
          <dt class="text-sm font-medium text-gray-900">Type</dt>
          <dd class="mt-1 text-sm text-gray-700 sm:col-span-2 sm:mt-0">
            <span class="inline-flex items-center gap-1.5">
              <%= render "notifiers/icon", notifier: @notifier, size_class: "size-4" %>
              <%= @notifier.type_name %>
            </span>
          </dd>
        </div>

        <% case @notifier.type %>
        <% when "Notifiers::Email" %>
          <div class="px-4 py-4 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
            <dt class="text-sm font-medium text-gray-900">Recipients</dt>
            <dd class="mt-1 text-sm text-gray-700 sm:col-span-2 sm:mt-0 font-mono">
              <%= @notifier.recipients.join(", ") %>
            </dd>
          </div>
        <% when "Notifiers::Slack" %>
          <div class="px-4 py-4 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
            <dt class="text-sm font-medium text-gray-900">Webhook URL</dt>
            <dd class="mt-1 text-sm text-gray-700 sm:col-span-2 sm:mt-0 font-mono truncate">
              <%= @notifier.webhook_url&.truncate(50) %>
            </dd>
          </div>
        <% when "Notifiers::Webhook" %>
          <div class="px-4 py-4 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
            <dt class="text-sm font-medium text-gray-900">URL</dt>
            <dd class="mt-1 text-sm text-gray-700 sm:col-span-2 sm:mt-0 font-mono truncate">
              <%= @notifier.url %>
            </dd>
          </div>
          <% if @notifier.headers.present? %>
            <div class="px-4 py-4 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
              <dt class="text-sm font-medium text-gray-900">Headers</dt>
              <dd class="mt-1 text-sm text-gray-700 sm:col-span-2 sm:mt-0">
                <ul class="font-mono text-xs space-y-1">
                  <% @notifier.headers.each do |key, value| %>
                    <li><%= key %>: <%= value.truncate(30) %></li>
                  <% end %>
                </ul>
              </dd>
            </div>
          <% end %>
          <div class="px-4 py-4 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
            <dt class="text-sm font-medium text-gray-900">Include Logs</dt>
            <dd class="mt-1 text-sm text-gray-700 sm:col-span-2 sm:mt-0">
              <%= @notifier.include_logs? ? "Yes" : "No" %>
            </dd>
          </div>
        <% end %>

        <div class="px-4 py-4 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
          <dt class="text-sm font-medium text-gray-900">Created</dt>
          <dd class="mt-1 text-sm text-gray-700 sm:col-span-2 sm:mt-0">
            <%= @notifier.created_at.strftime("%B %d, %Y at %I:%M %p") %>
          </dd>
        </div>
      </dl>
    </div>
  </div>

  <%# Test Notification %>
  <div class="bg-white rounded-2xl border-2 border-gray-200">
    <div class="px-4 py-6 sm:px-6">
      <h3 class="text-base font-semibold text-gray-900">Test Notification</h3>
      <p class="mt-1 text-sm text-gray-500">Send a test notification to verify the configuration.</p>
    </div>
    <div class="border-t border-gray-100 px-4 py-4 sm:px-6">
      <%= turbo_frame_tag dom_id(@notifier, :test) do %>
        <%= button_to "Send Test", notifier_test_path(@notifier),
            class: "inline-flex items-center rounded-xl bg-blue-600 px-4 py-2.5 text-sm font-semibold text-white hover:bg-blue-500",
            data: { turbo_frame: dom_id(@notifier, :test) } %>
      <% end %>
    </div>
  </div>

  <%# Notification Status %>
  <div class="bg-white rounded-2xl border-2 border-gray-200">
    <div class="px-4 py-6 sm:px-6">
      <h3 class="text-base font-semibold text-gray-900">Notification Status</h3>
    </div>
    <div class="border-t border-gray-100">
      <dl class="divide-y divide-gray-100">
        <div class="px-4 py-4 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
          <dt class="text-sm font-medium text-gray-900">Last Success</dt>
          <dd class="mt-1 text-sm text-gray-700 sm:col-span-2 sm:mt-0">
            <% if @notifier.last_notified_at %>
              <%= @notifier.last_notified_at.strftime("%B %d, %Y at %I:%M %p") %>
              <span class="text-gray-500">(<%= time_ago_in_words(@notifier.last_notified_at) %> ago)</span>
            <% else %>
              <span class="text-gray-500">Never</span>
            <% end %>
          </dd>
        </div>
        <div class="px-4 py-4 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
          <dt class="text-sm font-medium text-gray-900">Last Failure</dt>
          <dd class="mt-1 text-sm text-gray-700 sm:col-span-2 sm:mt-0">
            <% if @notifier.last_failed_at %>
              <div class="text-red-600">
                <%= @notifier.last_failed_at.strftime("%B %d, %Y at %I:%M %p") %>
                <span class="text-red-500">(<%= time_ago_in_words(@notifier.last_failed_at) %> ago)</span>
              </div>
              <% if @notifier.last_error.present? %>
                <p class="mt-1 text-xs text-red-500 font-mono"><%= @notifier.last_error %></p>
              <% end %>
            <% else %>
              <span class="text-gray-500">Never</span>
            <% end %>
          </dd>
        </div>
      </dl>
    </div>
  </div>
</div>
