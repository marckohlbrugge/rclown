<%= form_with model: backup, class: "space-y-6", builder: FormBuilder do |form| %>
  <% if backup.errors.any? %>
    <div class="rounded-xl border-2 border-red-200 bg-red-50 p-4">
      <h3 class="font-medium text-red-800"><%= pluralize(backup.errors.count, "error") %> prohibited this backup from being saved:</h3>
      <ul class="mt-2 list-disc list-inside text-red-700">
        <% backup.errors.each do |error| %>
          <li><%= error.full_message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div>
    <%= form.label :source_storage_id, "Source Storage", class: "block text-sm font-semibold text-gray-700 mb-2" %>
    <%= form.collection_select :source_storage_id, Storage.includes(:provider).order(:bucket_name), :id, ->(s) { "#{s.name} (#{s.provider.name})" }, { include_blank: "Select source storage" }, { autofocus: true } %>
    <p class="mt-2 text-sm text-gray-500">The storage location to back up from.</p>
  </div>

  <div>
    <%= form.label :destination_storage_id, "Destination Storage", class: "block text-sm font-semibold text-gray-700 mb-2" %>
    <%= form.collection_select :destination_storage_id, Storage.includes(:provider).order(:bucket_name), :id, ->(s) { "#{s.name} (#{s.provider.name})" }, { include_blank: "Select destination storage" }, {} %>
    <p class="mt-2 text-sm text-gray-500">The storage location to back up to.</p>
  </div>

  <div>
    <%= form.label :schedule, class: "block text-sm font-semibold text-gray-700 mb-2" %>
    <%= form.select :schedule, Backup.schedules.keys.map { |k| [k.capitalize, k] }, {} %>
  </div>

  <div class="flex items-center gap-x-3">
    <%= form.check_box :enabled, class: "size-5 rounded-lg border-2 border-gray-300 text-blue-600 focus:ring-blue-500" %>
    <%= form.label :enabled, "Enabled", class: "text-sm font-semibold text-gray-700" %>
  </div>

  <div class="flex items-center justify-end gap-x-4 border-t border-gray-200 pt-6">
    <%= link_to "Cancel", backup.persisted? ? backup : backups_path, class: "px-4 py-3 text-sm font-semibold text-gray-600 hover:text-gray-900" %>
    <%= form.submit backup.persisted? ? "Update Backup" : "Create Backup", class: "rounded-xl bg-blue-600 px-6 py-3 text-sm font-semibold text-white hover:bg-blue-500 cursor-pointer" %>
  </div>
<% end %>
