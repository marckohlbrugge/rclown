<%= form_with model: backup, class: "space-y-6" do |form| %>
  <% if backup.errors.any? %>
    <div class="rounded-xl border-2 border-red-200 bg-red-50 p-4">
      <h3 class="font-medium text-red-800"><%= pluralize(backup.errors.count, "error") %> prohibited this backup from being saved:</h3>
      <ul class="mt-2 list-disc list-inside text-red-700">
        <% backup.errors.each do |error| %>
          <li><%= error.full_message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="flex items-start gap-4">
    <div class="flex-1 space-y-4">
      <div>
        <%= form.label :source_storage_id, "Source", class: "block text-sm font-semibold text-gray-700 mb-2" %>
        <%= form.collection_select :source_storage_id, Storage.available_as_source.includes(:provider).order(:bucket_name), :id, ->(s) { "#{s.name} (#{s.provider.name})" }, { include_blank: "Select source" }, { autofocus: true } %>
      </div>
      <div>
        <%= form.label :source_path, "Source Path", class: "block text-sm font-semibold text-gray-700 mb-2" %>
        <%= form.text_field :source_path, class: "font-mono", placeholder: "path/within/bucket" %>
        <p class="mt-1 text-xs text-gray-500">Optional path within the bucket</p>
      </div>
    </div>

    <div class="flex items-center pt-7 text-gray-400">
      <svg class="size-6" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3" />
      </svg>
    </div>

    <div class="flex-1 space-y-4">
      <div>
        <%= form.label :destination_storage_id, "Destination", class: "block text-sm font-semibold text-gray-700 mb-2" %>
        <%= form.collection_select :destination_storage_id, Storage.available_as_destination.includes(:provider).order(:bucket_name), :id, ->(s) { "#{s.name} (#{s.provider.name})" }, { include_blank: "Select destination" }, {} %>
      </div>
      <div>
        <%= form.label :destination_path, "Destination Path", class: "block text-sm font-semibold text-gray-700 mb-2" %>
        <%= form.text_field :destination_path, class: "font-mono", placeholder: "path/within/bucket" %>
        <p class="mt-1 text-xs text-gray-500">Optional path within the bucket</p>
      </div>
    </div>
  </div>

  <div>
    <%= form.label :schedule, class: "block text-sm font-semibold text-gray-700 mb-2" %>
    <div class="flex gap-3">
      <% Backup.schedules.keys.each do |schedule| %>
        <div class="flex-1">
          <%= form.radio_button :schedule, schedule, class: "sr-only peer" %>
          <%= form.label :schedule, value: schedule, class: "flex items-center justify-center px-4 py-3 border-2 rounded-xl cursor-pointer transition-colors border-gray-200 hover:border-gray-300 peer-checked:border-blue-500 peer-checked:bg-blue-50 peer-checked:hover:border-blue-400" do %>
            <span class="text-sm font-medium text-gray-700"><%= schedule.capitalize %></span>
          <% end %>
        </div>
      <% end %>
    </div>
  </div>

  <div class="flex items-center gap-x-3">
    <%= form.check_box :enabled, class: "size-5 rounded-lg border-2 border-gray-300 text-blue-600 focus:ring-blue-500" %>
    <%= form.label :enabled, "Enabled", class: "text-sm font-semibold text-gray-700" %>
  </div>

  <div class="flex items-center justify-end gap-x-4 border-t border-gray-200 pt-6">
    <%= link_to "Cancel", backup.persisted? ? backup : backups_path, class: "px-4 py-3 text-sm font-semibold text-gray-600 hover:text-gray-900" %>
    <%= form.submit backup.persisted? ? "Update Backup" : "Create Backup", class: "rounded-xl bg-blue-600 px-6 py-3 text-sm font-semibold text-white hover:bg-blue-500 cursor-pointer" %>
  </div>
<% end %>
