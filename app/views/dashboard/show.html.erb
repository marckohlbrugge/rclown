<% page_header "Dashboard" %>

<div class="space-y-6">
  <%# Stats %>
  <div class="grid grid-cols-2 gap-4 sm:grid-cols-5">
    <div class="rounded-2xl border-2 border-gray-200 px-4 py-5">
      <dt class="text-sm font-medium text-gray-500">Total Backups</dt>
      <dd class="mt-1 text-3xl font-semibold text-gray-900"><%= @stats[:total_backups] %></dd>
    </div>
    <div class="rounded-2xl border-2 border-gray-200 px-4 py-5">
      <dt class="text-sm font-medium text-gray-500">Enabled</dt>
      <dd class="mt-1 text-3xl font-semibold text-green-600"><%= @stats[:enabled_backups] %></dd>
    </div>
    <div class="rounded-2xl border-2 border-gray-200 px-4 py-5">
      <dt class="text-sm font-medium text-gray-500">Running</dt>
      <dd class="mt-1 text-3xl font-semibold text-blue-600"><%= @stats[:running_backups] %></dd>
    </div>
    <div class="rounded-2xl border-2 border-gray-200 px-4 py-5">
      <dt class="text-sm font-medium text-gray-500">Successful Today</dt>
      <dd class="mt-1 text-3xl font-semibold text-green-600"><%= @stats[:successful_today] %></dd>
    </div>
    <div class="rounded-2xl border-2 border-gray-200 px-4 py-5">
      <dt class="text-sm font-medium text-gray-500">Failed Today</dt>
      <dd class="mt-1 text-3xl font-semibold <%= @stats[:failed_today] > 0 ? 'text-red-600' : 'text-gray-400' %>"><%= @stats[:failed_today] %></dd>
    </div>
  </div>

  <div class="grid grid-cols-1 gap-6 lg:grid-cols-2">
    <%# Recent Backups %>
    <div class="bg-white rounded-2xl border-2 border-gray-200">
      <div class="px-4 py-6 sm:px-6 flex items-center justify-between">
        <h3 class="text-base font-semibold text-gray-900">Backups</h3>
        <%= link_to "View all", backups_path, class: "text-sm font-medium text-blue-600 hover:text-blue-500" %>
      </div>
      <div class="border-t border-gray-200">
        <% if @backups.any? %>
          <ul role="list" class="divide-y divide-gray-100">
            <% @backups.each do |backup| %>
              <li>
                <%= link_to backup, class: "flex items-center justify-between gap-x-6 px-4 py-4 hover:bg-gray-50 sm:px-6" do %>
                  <div class="min-w-0">
                    <p class="text-base font-medium text-gray-900">
                      <%= backup.source_storage.name %> → <%= backup.destination_storage.name %>
                    </p>
                  </div>
                  <%= render "backups/status_badge", backup: backup %>
                <% end %>
              </li>
            <% end %>
          </ul>
        <% else %>
          <div class="px-4 py-8 text-center text-sm text-gray-500">
            No backups configured. <%= link_to "Create one", new_backup_path, class: "text-blue-600 hover:underline" %>.
          </div>
        <% end %>
      </div>
    </div>

    <%# Recent Runs %>
    <div class="bg-white rounded-2xl border-2 border-gray-200">
      <div class="px-4 py-6 sm:px-6">
        <h3 class="text-base font-semibold text-gray-900">Recent Runs</h3>
      </div>
      <div class="border-t border-gray-200">
        <% if @recent_runs.any? %>
          <ul role="list" class="divide-y divide-gray-100">
            <% @recent_runs.each do |run| %>
              <li>
                <%= link_to backup_run_path(run.backup, run), class: "flex items-center justify-between gap-x-6 px-4 py-4 hover:bg-gray-50 sm:px-6" do %>
                  <div class="min-w-0">
                    <p class="text-base font-medium text-gray-900">
                      <%= run.backup.source_storage.name %> → <%= run.backup.destination_storage.name %>
                    </p>
                    <p class="text-sm text-gray-600">
                      <%= time_ago_in_words(run.created_at) %> ago
                      <% if run.formatted_duration %>
                        · <%= run.formatted_duration %>
                      <% end %>
                    </p>
                  </div>
                  <%
                    case run.status
                    when "success"
                      badge_class = "bg-green-100 text-green-700"
                      icon = :check
                    when "failed"
                      badge_class = "bg-red-100 text-red-700"
                      icon = :x
                    when "running"
                      badge_class = "bg-blue-100 text-blue-700"
                      icon = :spinner
                    else
                      badge_class = "bg-gray-100 text-gray-600"
                      icon = :clock
                    end
                  %>
                  <span class="inline-flex items-center gap-1 rounded-lg px-2.5 py-1 text-sm font-medium <%= badge_class %>">
                    <% case icon %>
                    <% when :check %>
                      <svg class="size-4" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M16.704 4.153a.75.75 0 01.143 1.052l-8 10.5a.75.75 0 01-1.127.075l-4.5-4.5a.75.75 0 011.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 011.05-.143z" clip-rule="evenodd" />
                      </svg>
                    <% when :x %>
                      <svg class="size-4" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z" />
                      </svg>
                    <% when :spinner %>
                      <svg class="size-4 animate-spin" viewBox="0 0 24 24" fill="none">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                      </svg>
                    <% when :clock %>
                      <svg class="size-4" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm.75-13a.75.75 0 00-1.5 0v5c0 .414.336.75.75.75h4a.75.75 0 000-1.5h-3.25V5z" clip-rule="evenodd" />
                      </svg>
                    <% end %>
                    <%= run.status.capitalize %>
                  </span>
                <% end %>
              </li>
            <% end %>
          </ul>
        <% else %>
          <div class="px-4 py-8 text-center text-sm text-gray-500">
            No runs yet.
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>
