<% page_header "Dashboard" %>

<div class="space-y-6">
  <%# Stats %>
  <div class="grid grid-cols-2 gap-4 sm:grid-cols-5">
    <div class="bg-white shadow-sm ring-1 ring-gray-900/5 rounded-xl px-4 py-5">
      <dt class="text-sm font-medium text-gray-500">Total Backups</dt>
      <dd class="mt-1 text-3xl font-semibold text-gray-900"><%= @stats[:total_backups] %></dd>
    </div>
    <div class="bg-white shadow-sm ring-1 ring-gray-900/5 rounded-xl px-4 py-5">
      <dt class="text-sm font-medium text-gray-500">Enabled</dt>
      <dd class="mt-1 text-3xl font-semibold text-green-600"><%= @stats[:enabled_backups] %></dd>
    </div>
    <div class="bg-white shadow-sm ring-1 ring-gray-900/5 rounded-xl px-4 py-5">
      <dt class="text-sm font-medium text-gray-500">Running</dt>
      <dd class="mt-1 text-3xl font-semibold text-blue-600"><%= @stats[:running_backups] %></dd>
    </div>
    <div class="bg-white shadow-sm ring-1 ring-gray-900/5 rounded-xl px-4 py-5">
      <dt class="text-sm font-medium text-gray-500">Successful Today</dt>
      <dd class="mt-1 text-3xl font-semibold text-green-600"><%= @stats[:successful_today] %></dd>
    </div>
    <div class="bg-white shadow-sm ring-1 ring-gray-900/5 rounded-xl px-4 py-5">
      <dt class="text-sm font-medium text-gray-500">Failed Today</dt>
      <dd class="mt-1 text-3xl font-semibold <%= @stats[:failed_today] > 0 ? 'text-red-600' : 'text-gray-400' %>"><%= @stats[:failed_today] %></dd>
    </div>
  </div>

  <div class="grid grid-cols-1 gap-6 lg:grid-cols-2">
    <%# Recent Backups %>
    <div class="bg-white shadow-sm ring-1 ring-gray-900/5 sm:rounded-xl">
      <div class="px-4 py-6 sm:px-6 flex items-center justify-between">
        <h3 class="text-base font-semibold text-gray-900">Backups</h3>
        <%= link_to "View all", backups_path, class: "text-sm font-medium text-blue-600 hover:text-blue-500" %>
      </div>
      <div class="border-t border-gray-100">
        <% if @backups.any? %>
          <ul role="list" class="divide-y divide-gray-100">
            <% @backups.each do |backup| %>
              <li class="flex items-center justify-between gap-x-6 px-4 py-3 sm:px-6">
                <div class="min-w-0">
                  <p class="text-sm font-medium text-gray-900">
                    <%= link_to backup.name, backup, class: "hover:underline" %>
                  </p>
                  <p class="text-xs text-gray-500">
                    <%= backup.source_storage.name %> â†’ <%= backup.destination_storage.name %>
                  </p>
                </div>
                <%= render "backups/status_badge", backup: backup %>
              </li>
            <% end %>
          </ul>
        <% else %>
          <div class="px-4 py-8 text-center text-sm text-gray-500">
            No backups configured. <%= link_to "Create one", new_backup_path, class: "text-blue-600 hover:underline" %>.
          </div>
        <% end %>
      </div>
    </div>

    <%# Recent Runs %>
    <div class="bg-white shadow-sm ring-1 ring-gray-900/5 sm:rounded-xl">
      <div class="px-4 py-6 sm:px-6">
        <h3 class="text-base font-semibold text-gray-900">Recent Runs</h3>
      </div>
      <div class="border-t border-gray-100">
        <% if @recent_runs.any? %>
          <ul role="list" class="divide-y divide-gray-100">
            <% @recent_runs.each do |run| %>
              <li class="flex items-center justify-between gap-x-6 px-4 py-3 sm:px-6">
                <div class="min-w-0">
                  <p class="text-sm font-medium text-gray-900">
                    <%= link_to run.backup.name, backup_run_path(run.backup, run), class: "hover:underline" %>
                  </p>
                  <p class="text-xs text-gray-500">
                    <%= time_ago_in_words(run.created_at) %> ago
                    <% if run.formatted_duration %>
                      &middot; <%= run.formatted_duration %>
                    <% end %>
                  </p>
                </div>
                <%
                  case run.status
                  when "success"
                    badge_class = "bg-green-50 text-green-700 ring-green-600/20"
                  when "failed"
                    badge_class = "bg-red-50 text-red-700 ring-red-600/20"
                  when "running"
                    badge_class = "bg-blue-50 text-blue-700 ring-blue-600/20"
                  else
                    badge_class = "bg-gray-50 text-gray-600 ring-gray-500/10"
                  end
                %>
                <span class="inline-flex items-center rounded-md px-2 py-1 text-xs font-medium ring-1 ring-inset <%= badge_class %>">
                  <%= run.status.capitalize %>
                </span>
              </li>
            <% end %>
          </ul>
        <% else %>
          <div class="px-4 py-8 text-center text-sm text-gray-500">
            No runs yet.
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>
